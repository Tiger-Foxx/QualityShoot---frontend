<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Tutoriel : Cr√©er un ex√©cutable (.exe) pour une app Electron+Python (Qualit√© PRO)</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.0/dist/tailwind.min.css" rel="stylesheet">
    <style>
        code { background: #191f2b; color: #d1d5db; padding: 2px 6px; border-radius: 4px;}
        pre { background: #1e293b; color: #d1d5db; padding: 1rem; border-radius: 8px; overflow-x: auto;}
        .step { @apply mb-8 }
        .tip { @apply bg-blue-100 border-l-4 border-blue-500 text-blue-700 px-4 py-2 rounded my-2;}
        .warn { @apply bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 px-4 py-2 rounded my-2;}
        .error { @apply bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-2 rounded my-2;}
        .check { @apply text-green-600 mr-2 }
        .folder { font-family: 'Fira Mono', 'Consolas', monospace; color: #60a5fa; font-size: 0.95em;}
        .section-title { @apply text-2xl mt-10 mb-5 font-bold border-b-2 border-gray-300 pb-2;}
        .subsection-title { @apply text-xl mt-8 mb-2 font-bold;}
    </style>
</head>
<body class="bg-gray-100 text-gray-900">
<div class="max-w-5xl mx-auto px-4 py-10">
    <h1 class="text-4xl font-extrabold text-blue-600 mb-6">üöÄ Guide Complet : Packager une App Electron + Python en EXE</h1>

    <div class="bg-white rounded-xl shadow p-6 mb-10">
        <p class="mb-3">Ce guide vous accompagne pour :</p>
        <ul class="list-disc ml-8">
            <li>Corriger l‚Äôerreur <b>Autofill.enable</b> dans Electron</li>
            <li>Cr√©er un <b>ex√©cutable (.exe)</b> pour votre application <b>Electron/React</b></li>
            <li>Cr√©er un <b>ex√©cutable (.exe)</b> pour votre <b>serveur Python FastAPI</b> (avec <code>assets</code> embarqu√©s !)</li>
            <li>Faire d√©marrer le serveur Python automatiquement depuis Electron</li>
            <li>Bonus : Archi "Lanceur" si besoin de g√©rer les deux process proprement</li>
            <li>üìù <b>Tout illustr√©, √©tape par √©tape, pour d√©butants</b></li>
        </ul>
    </div>

    <div class="section-title">1Ô∏è‚É£ Correction de l‚Äôerreur <code>Autofill.enable</code> dans Electron</div>

    <div class="mb-5">
        <p>
            Cette erreur appara√Æt dans la console DevTools d‚ÄôElectron :
        </p>
        <pre>
[13580:0528/024406.399:ERROR:CONSOLE:1] "Request Autofill.enable failed. {"code":-32601,"message":"'Autofill.enable' wasn't found"}"
[13580:0528/024406.399:ERROR:CONSOLE:1] "Request Autofill.setAddresses failed. {"code":-32601,"message":"'Autofill.setAddresses' wasn't found"}"
      </pre>
        <div class="tip">
            üëâ <b>Ce n‚Äôest pas une erreur critique !</b><br>
            Electron/Chromium affiche √ßa car <b>l‚ÄôAPI Autofill n‚Äôest pas dispo en mode desktop</b> (pas de remplissage auto dans Electron).<br>
            <b>Vous pouvez ignorer</b>, ou <b>masquer ce warning</b> en d√©sactivant l‚Äôautofill dans DevTools, ou en filtrant les logs.
        </div>
        <div class="warn">
            <b>Vous pouvez continuer votre build sans probl√®me.</b>
        </div>
    </div>

    <div class="section-title">2Ô∏è‚É£ G√©n√©rer l‚ÄôEXE de votre app Electron (frontend React)</div>

    <div class="mb-5">
        <div class="subsection-title">A. Installer les d√©pendances n√©cessaires</div>
        <ul class="list-decimal ml-8 mb-3">
            <li>Assurez-vous d‚Äôavoir <b>Node.js</b> (16+), <b>npm</b> ou <b>yarn</b> install√©s</li>
            <li>Dans votre dossier <span class="folder">frontend</span> (racine Electron/React) :
                <pre>
npm install
npm install electron --save-dev
npm install electron-builder --save-dev
# Si tu utilises Vite + React :
npm install vite react react-dom
</pre>
            </li>
        </ul>
    </div>

    <div class="mb-5">
        <div class="subsection-title">B. Structure attendue du projet Electron/React</div>
        <div class="bg-gray-200 rounded p-3 font-mono text-xs">
            frontend/
            ‚îú‚îÄ‚îÄ package.json
            ‚îú‚îÄ‚îÄ public/
            ‚îÇ   ‚îî‚îÄ‚îÄ electron.cjs, preload.cjs, ...
            ‚îú‚îÄ‚îÄ src/
            ‚îÇ   ‚îú‚îÄ‚îÄ main.tsx, App.tsx, ...
            ‚îÇ   ‚îú‚îÄ‚îÄ assets/
            ‚îÇ   ‚îî‚îÄ‚îÄ ...
            ‚îú‚îÄ‚îÄ electron-main.js (ou electron.cjs)
            ‚îî‚îÄ‚îÄ ...
        </div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">C. Configurer <code>electron-builder</code> dans <code>package.json</code></div>
        <pre>
{
  "name": "qualityshoot-frontend",
  "version": "1.0.0",
  "main": "public/electron.cjs",
  ...
  "build": {
    "appId": "com.yourdomain.qualityshoot",
    "productName": "QualityShoot",
    "directories": {
      "output": "dist-electron"
    },
    "files": [
      "dist/**",    // build du React (Vite/CRA)
      "public/**",  // electron.cjs, preload.cjs, etc.
      "assets/**"   // si tu veux inclure assets du front
    ],
    "extraResources": [
      {
        "from": "../backend-dist",  // dossier o√π tu mettras ton EXE Python + assets
        "to": "backend"
      }
    ],
    "win": {
      "target": "nsis",
      "icon": "public/logo.png"
    }
  },
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build-electron": "electron-builder"
  }
}
      </pre>
        <div class="tip">
            <b>Astuce :</b> <br>
            <code>extraResources</code> permet d‚Äôembarquer ton serveur Python packag√© et ses assets directement dans l‚ÄôEXE Electron, dans le dossier <b>backend/</b> du build.
        </div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">D. Build du Front (React/Vite) + Electron</div>
        <ul class="list-decimal ml-8 mb-3">
            <li>Build du front (Vite ou CRA) :
                <pre>
npm run build
# ou
yarn build
</pre>
            </li>
            <li>Build de l‚ÄôEXE Electron :
                <pre>
npm run build-electron
</pre>
            </li>
            <li>L‚Äôex√©cutable se trouve dans <span class="folder">frontend/dist-electron/</span></li>
        </ul>
        <div class="warn">
            <b>Attention :</b> <br>
            <ul>
                <li>Le serveur Python n‚Äôest pas inclus ici ! Il faudra le packager √† part (voir plus bas).</li>
                <li>Pour embarquer le backend, voir la section <b>ExtraResources</b> plus haut.</li>
            </ul>
        </div>
    </div>

    <div class="section-title">3Ô∏è‚É£ Packager le serveur Python (.exe) avec PyInstaller</div>

    <div class="mb-5">
        <div class="subsection-title">A. Installer PyInstaller</div>
        <pre>
pip install pyinstaller
      </pre>
        <div class="tip">
            Utilisez <code>python -m venv venv</code> puis <code>venv\Scripts\activate</code> pour isoler votre environnement.
        </div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">B. Structurer les assets et d√©pendances</div>
        <ul class="list-disc ml-7">
            <li>Placez tous vos assets n√©cessaires dans <span class="folder">backend/assets/</span> (mod√®les IA, exiftool, ffmpeg, ...)</li>
            <li>V√©rifiez <code>requirements.txt</code> pour toutes les librairies n√©cessaires !</li>
        </ul>
        <div class="warn">‚ö†Ô∏è <b>Attention :</b> Certains packages (onnxruntime, opencv, etc) peuvent n√©cessiter des options sp√©ciales lors du pack.</div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">C. G√©n√©rer l‚Äôex√©cutable avec PyInstaller</div>
        <ul class="list-decimal ml-7">
            <li>Placez-vous dans <span class="folder">backend/</span></li>
            <li>Lancez la commande :
                <pre>
pyinstaller --onefile --noconsole --add-data "assets;assets" --add-data ".env;." main.py
</pre>
            </li>
            <li>
                <b>Explications :</b>
                <ul class="list-disc ml-7">
                    <li><code>--onefile</code> : un seul EXE</li>
                    <li><code>--noconsole</code> : pas de fen√™tre noire</li>
                    <li><code>--add-data "assets;assets"</code> : inclut le dossier assets dans l‚ÄôEXE (attention au <code>;</code> sous Windows, <code>:</code> sous Linux/Mac)</li>
                    <li><code>--add-data ".env;."</code> : embarque le .env</li>
                </ul>
            </li>
            <li>L‚Äôex√©cutable sera g√©n√©r√© dans <span class="folder">dist/main.exe</span></li>
        </ul>
        <div class="tip">
            <b>Si vous avez des assets dans des sous-dossiers :</b><br>
            Ajoutez autant de <code>--add-data</code> que n√©cessaire.<br>
            Pour plusieurs assets : <code>--add-data "assets/AI-onnx;assets/AI-onnx"</code>
        </div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">D. G√©rer les assets dans le code Python</div>
        <pre>
import sys
from pathlib import Path

def get_asset_path(relative_path):
    if getattr(sys, 'frozen', False):  # EXE PyInstaller
        base_path = Path(sys._MEIPASS)
    else:
        base_path = Path(__file__).parent
    return base_path / relative_path

# Exemple d'utilisation
ffmpeg_path = get_asset_path("assets/ffmpeg/ffmpeg.exe")
      </pre>
        <div class="tip">Utilisez ce helper partout o√π vous acc√©dez √† des assets !</div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">E. Erreurs courantes avec PyInstaller</div>
        <ul class="list-disc ml-7">
            <li class="error"><b>ModuleNotFoundError</b>: Ajoutez le module manuellement via <code>--hidden-import</code></li>
            <li class="error"><b>OnnxRuntime / OpenCV DLL load failed</b>: Copiez les DLL n√©cessaires dans <code>assets/</code> et ajoutez-les avec <code>--add-binary</code></li>
            <li class="error"><b>Assets non trouv√©s</b>: Toujours utiliser le helper <code>get_asset_path()</code> ci-dessus</li>
            <li class="error">Chemin <code>assets;assets</code> sous Windows, <code>assets:assets</code> sous Linux/Mac</li>
            <li class="error">Le EXE Python est tr√®s gros ? Utilisez <code>--onefile</code> pour r√©duire, mais <b>ne supprimez pas les DLL n√©cessaires</b></li>
        </ul>
    </div>

    <div class="section-title">4Ô∏è‚É£ Faire d√©marrer le serveur Python automatiquement depuis Electron</div>

    <div class="mb-5">
        <div class="subsection-title">A. Modifier <code>electron.cjs</code> pour lancer le backend</div>
        <pre>
const { app, BrowserWindow } = require('electron');
const path = require('path');
const { spawn } = require('child_process');

let pythonProcess = null;

function createWindow() {
  const win = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      preload: path.join(__dirname, 'preload.cjs'),
      nodeIntegration: false,
      contextIsolation: true
    }
  });

  win.loadURL('http://localhost:5173'); // ou le build local

  // D√©marrer le serveur Python packag√©
  const backendPath = path.resolve(__dirname, 'backend', process.platform === 'win32' ? 'main.exe' : 'main');
  pythonProcess = spawn(backendPath, [], {
    cwd: path.dirname(backendPath),
    detached: false,
    stdio: 'ignore'
  });

  // Optionnel : Fermer backend √† la fermeture de l'app
  win.on('closed', () => {
    if (pythonProcess) {
      pythonProcess.kill();
      pythonProcess = null;
    }
  });
}

app.whenReady().then(createWindow);

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') app.quit();
});
      </pre>
        <div class="tip">
            <b>Astuce :</b> Utilisez <code>backend/main.exe</code> pour Windows, <code>backend/main</code> pour Linux/Mac.<br>
            <b>V√©rifiez que le backend √©coute bien sur le port 8000 (ou configurer selon besoin) !</b>
        </div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">B. Faire pointer l‚ÄôAPI du front vers le serveur Python local</div>
        <div class="bg-gray-200 rounded p-3 mb-2">
            <b>Dans <code>apiService.ts</code> :</b><br>
            <code>const API_BASE_URL = 'http://127.0.0.1:8000';</code>
        </div>
        <div class="tip">
            <b>Si votre backend √©coute sur un autre port, modifiez ici !</b>
        </div>
    </div>

    <div class="mb-5">
        <div class="subsection-title">C. Tester l‚Äôint√©gration finale</div>
        <ul class="list-decimal ml-8">
            <li>Lancez l‚ÄôEXE Electron (<code>QualityShoot Setup.exe</code> ou <code>QualityShoot.exe</code>)</li>
            <li>Le serveur Python doit d√©marrer en arri√®re-plan</li>
            <li>Le front doit pouvoir dialoguer via <code>http://127.0.0.1:8000</code></li>
            <li>Si besoin, ajoutez des logs dans Electron pour d√©boguer le <code>spawn</code> du serveur</li>
        </ul>
    </div>

    <div class="section-title">5Ô∏è‚É£ (Bonus) Lanceur s√©par√© pour g√©rer les deux EXE</div>
    <div class="mb-5">
        <p>
            <b>Pour un packaging ultra-pro, certains pr√©f√®rent un petit "launcher" qui d√©marre backend ET frontend</b>.<br>
            <b>Recommand√© si :</b> <ul class="list-disc ml-8"><li>Vous voulez surveiller/crasher/rebooter le serveur python si crash</li><li>Vous voulez afficher un splash screen + animation pendant le boot</li></ul>
        </p>
        <div class="tip">
            <b>Le plus simple :</b> Electron = le lanceur, fait spawn() le backend + le front dans le m√™me app. <br>
            <b>Ou :</b> un petit batch/shell/EXE C# qui lance les deux EXE.
        </div>
        <pre>
# Ex: "launcher.js" (Node/Electron, mode script)
const { spawn } = require('child_process');
const path = require('path');
spawn(path.join(__dirname, 'backend', 'main.exe'), {detached: true});
spawn(path.join(__dirname, 'frontend', 'QualityShoot.exe'), {detached: true});
      </pre>
        <div class="tip">
            Si tu veux un vrai splash screen, utilise une <b>fen√™tre Electron custom</b> qui affiche une animation, puis lance le reste.
        </div>
    </div>

    <div class="section-title">6Ô∏è‚É£ Questions/R√©ponses et FAQ</div>
    <div class="mb-8">
        <ul class="list-disc ml-8">
            <li><b>Q : Mon EXE Python ne trouve pas les assets (mod√®les, ffmpeg, etc.)</b><br>
                <span class="tip">V√©rifie que tu utilises le helper <code>get_asset_path()</code> partout !</span>
            </li>
            <li><b>Q : L‚Äôex√©cutable Electron ne lance pas le backend ?</b><br>
                <span class="tip">V√©rifie le chemin dans <code>spawn()</code> et que le backend fonctionne bien seul.</span>
            </li>
            <li><b>Q : J‚Äôai toujours l‚Äôerreur Autofill.enable ?</b><br>
                <span class="warn">C‚Äôest normal, c‚Äôest Chromium. Ignore !</span>
            </li>
            <li><b>Q : L‚ÄôEXE est trop gros ?</b><br>
                <span class="tip">PyInstaller emballe tout. Tu peux minimiser en utilisant <code>--onefile</code> et en excluant les modules non utilis√©s.</span>
            </li>
            <li><b>Q : Peut-on updater le backend sans recompiler Electron ?</b><br>
                <span class="tip">Oui, si tu gardes le dossier <code>backend/</code> s√©par√©, tu peux remplacer le <code>main.exe</code> sans toucher au front.</span>
            </li>
        </ul>
    </div>

    <div class="section-title">7Ô∏è‚É£ Ressources et liens utiles</div>
    <ul class="list-disc ml-8 mb-10">
        <li><a class="text-blue-600 underline" href="https://www.electron.build/" target="_blank">electron-builder (doc officielle)</a></li>
        <li><a class="text-blue-600 underline" href="https://pyinstaller.org/en/stable/" target="_blank">PyInstaller (doc officielle)</a></li>
        <li><a class="text-blue-600 underline" href="https://vitejs.dev/" target="_blank">Vite (pour React)</a></li>
        <li><a class="text-blue-600 underline" href="https://fastapi.tiangolo.com/deployment/" target="_blank">FastAPI deployment</a></li>
    </ul>

    <footer class="text-center text-gray-400 text-xs pt-10">
        &copy; 2025 Tutoriel g√©n√©r√© par Copilot ‚Äì Qualit√©Shoot Project
    </footer>
</div>
</body>
</html>